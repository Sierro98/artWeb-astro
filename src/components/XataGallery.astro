---
import { Image } from "astro:assets";
import { getXataClient } from "../xata";

interface Props {
  capsuleName: string;
}
const { capsuleName } = Astro.props;

const xata = getXataClient();
const data = await xata.db.works
  .filter({ "collection.name": capsuleName })
  .getPaginated({ pagination: { size: 20 } });
---

<div class="p-5 md:p-10">
  <div
    class="columns-1 sm:columns-2 lg:columns-3 gap-5 lg:gap-8 [&>div:not(:first-child)]:mt-5 lg:[&>div:not(:first-child)]:mt-8"
  >
    {
      data.records.map((record) => {
        const transImage = record.images?.transform({
          format: "avif",
        });
        return (
          <div class="relative w-fit">
            <Image
              class="object-cover"
              densities={[0.1]}
              src={transImage?.url || ""}
              inferSize
              alt={record.name}
            />
            <div class="absolute inset-0 flex items-center flex-col justify-center opacity-0 transition-opacity duration-300 bg-black/60 hover:opacity-100">
              <p class="text-white text-2xl capitalize">{record.name}</p>
              <br />
              <p class="text-white text-lg">{record.es_description}</p>
            </div>
          </div>
        );
      })
    }
  </div>
</div>
